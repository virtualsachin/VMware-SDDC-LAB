##
##    Project: VMware NSXT SDDC Design POC Lab
##    Authors: VirtualSachIN
##    Filename: playbooks/34-createCloudUser.yml
##
---
- hosts: localhost
  gather_facts: False
  connection: local
  vars_files:
    - ../answerfile.yml 
  name: Create cloud  users for cloud connecter
  tasks:
    - name: Create NSXT user credentials to  connect NSXT Cloud
      vmware.alb.avi_api_session:
        avi_credentials: "{{ AVI.credentials }}"
        http_method: post
        path: "cloudconnectoruser"
        data:
          nsxt_credentials:
              username: "{{ Nested_NSXT.Credential.admin.Name }}"
              password: "{{ Nested_NSXT.Credential.admin.Password }}"
          name: "{{ Nested_NSXT.Components.LocalManager.FQDN  }}"

    - name: Create vCenter user credentials to  connect VMware vCenter/ESXi Cloud
      vmware.alb.avi_api_session:
        avi_credentials: "{{ AVI.credentials }}"
        http_method: post
        path: "cloudconnectoruser"
        data:
          vcenter_credentials:
              username: "{{ Nested_vCenter.User }}"
              password: "{{ Nested_vCenter.Password }}"
          name: "{{ Nested_vCenter.FQDN }}"

